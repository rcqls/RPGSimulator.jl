# New Book

```julia (editor=true, logging=false, output=true)
using Bonito, Tables
import Pkg; Pkg.activate("C:/Users/Hussin/Documents/GitHub/RPGSimulator.jl") # Quand ce sera le final on pourra l'enlever
using RPGSimulator

# Création des personnages
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# Simulation de 5 combats
all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")

# Affichage résumé des combats
Bonito.DOM.div(
    Bonito.DOM.h2("Résumé des combats"),
    Bonito.Table(summary)
)

```
```julia (editor=true, logging=false, output=true)
# Création des personnages
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# Simulation de 5 combats
all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")

# Préparation des données PV par round
pv = DataFrame(combat=all_logs.combat, round=all_logs.round, actor=all_logs.actor, pv=all_logs.actor_PV)

# Affichage points de vie par round
Bonito.DOM.div(
    Bonito.DOM.h2("Points de vie par round"),
    Bonito.Table(pv)
)

```
```julia (editor=true, logging=false, output=true)
# Simulation / exemple de données DEFENSE par round
defense_data = DataFrame(combat=Int[], round=Int[], actor=String[], defense=Int[])

# Simule données pour 2 personnages sur 5 rounds
for combat_id in 1:3
    for round in 0:5
        push!(defense_data, (combat_id, round, "Jed", max(10, 20 - round)))
        push!(defense_data, (combat_id, round, "Hussin", max(5, 15 - 2*round)))
    end
end

# Affichage avec Bonito
Bonito.DOM.div(
    Bonito.DOM.h2("Défense par round"),
    Bonito.Table(defense_data)
)

```
```julia (editor=true, logging=false, output=true)
using CSV, DataFrames, Statistics
using Bonito, Tables
using Plots
Plots.plotlyjs()  # Backend interactif

include("../Examples/test.jl")

# --- Création des personnages ---
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# --- Simulation de 5 combats ---
all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")

# --- Exemple : colonne DEFENSE pour le graphique ---
all_logs.defense = [archer.stats.DEFENSE for i in 1:nrow(all_logs)]
all_logs.defense[end÷2:end] .= gobelin.stats.DEFENSE

# --- Calcul défense moyenne par round et acteur ---
defense_summary = combine(groupby(all_logs, [:actor, :round]), :defense => mean)

# --- Création du graphique ---
fig = Plots.plot(title="Défense moyenne par round", xlabel="Round", ylabel="Défense")
for name in unique(defense_summary.actor)
    sub = filter(:actor => ==(name), defense_summary)
    Plots.plot!(fig, sub.round, sub.defense_mean, label=name, marker=:circle, linewidth=2)
end

# --- Export HTML pour inclusion dans Bonito ---
html_file = "defense_plot.html"
Plots.savefig(fig, html_file)  # sauvegarde en HTML interactif

# Sauvegarde en image
Plots.savefig(fig, "defense_plot.svg")  # PNG interactif limité, mais visible

# Affichage dans Bonito
Bonito.DOM.div(
    Bonito.DOM.h2("Résumé des combats"),
    Bonito.Table(summary),
    Bonito.DOM.h2("Défense moyenne par round"),
    Bonito.DOM.img(src="defense_plot.svg", width="800px")
)


```
```julia (editor=true, logging=false, output=true)
using CSV, DataFrames, Statistics
using Bonito, Tables
using WGLMakie, Observables, Components

include("../Examples/test.jl")

# --- Sliders interactifs pour stats des personnages ---
archer_atk_slider = Components.Slider(1:100; value=30)
archer_def_slider = Components.Slider(1:50; value=10)
gobelin_atk_slider = Components.Slider(1:100; value=35)
gobelin_def_slider = Components.Slider(1:50; value=5)

# --- Observable pour stocker les logs de combat recalculés ---
combat_data = Observable((DataFrame(), DataFrame()))  # all_logs, summary

# --- Fonction pour simuler les combats selon les stats actuelles ---
function update_combat!()
    # Création des personnages avec les stats des sliders
    archer = Archer(nom="Jed")
    archer.stats = Stats(PV=100, PM=20, ATK=archer_atk_slider.value[], VITESSE=40, DEFENSE=archer_def_slider.value[])
    
    gobelin = Gobelin(nom="Hussin")
    gobelin.stats = Stats(PV=120, PM=0, ATK=gobelin_atk_slider.value[], VITESSE=40, DEFENSE=gobelin_def_slider.value[])
    
    # Simuler 5 combats
    all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")
    
    # Exemple : colonne DEFENSE
    all_logs.defense = [archer.stats.DEFENSE for i in 1:nrow(all_logs)]
    all_logs.defense[end÷2:end] .= gobelin.stats.DEFENSE
    
    # Défense moyenne par round
    defense_summary = combine(groupby(all_logs, [:actor, :round]), :defense => mean)
    
    # Stocker dans l'observable
    combat_data[] = (defense_summary, summary)
end

# Appel initial
update_combat!()

# --- Figure WGLMakie ---
fig = Figure(resolution=(800,400))
ax = Axis(fig[1,1], title="Défense moyenne par round", xlabel="Round", ylabel="Défense")
lines_plots = Dict{String, Lines}()  # pour mettre à jour les lignes existantes

# Fonction de mise à jour du graphique
function update_plot!()
    defense_summary, _ = combat_data[]
    
    for name in unique(defense_summary.actor)
        sub = filter(:actor => ==(name), defense_summary)
        if haskey(lines_plots, name)
            # mettre à jour les données
            lines_plots[name].x = sub.round
            lines_plots[name].y = sub.defense_mean
        else
            # tracer pour la première fois
            lines_plots[name] = lines!(ax, sub.round, sub.defense_mean, label=name, linewidth=2)
            scatter!(ax, sub.round, sub.defense_mean, color=:auto)
        end
    end
    axislegend(ax)
end

# Appel initial
update_plot!()

# --- Observables pour mettre à jour tout automatiquement ---
for slider in [archer_atk_slider, archer_def_slider, gobelin_atk_slider, gobelin_def_slider]
    slider.on(() -> begin
        update_combat!()
        update_plot!()
    end)
end

# --- Affichage BonitoBook ---
Bonito.DOM.div(
    Bonito.DOM.h2("Résumé des combats"),
    Bonito.Table(combat_data[][2]),  # summary
    Bonito.DOM.h2("Défense moyenne par round"),
    Grid(
        ["Archer ATK: ", archer_atk_slider],
        ["Archer DEF: ", archer_def_slider],
        ["Gobelin ATK: ", gobelin_atk_slider],
        ["Gobelin DEF: ", gobelin_def_slider];
        columns="auto 1fr", gap="10px 20px"
    ),
    fig;
    style=Styles("padding" => "20px")
)

```
