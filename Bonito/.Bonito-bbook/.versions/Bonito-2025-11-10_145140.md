# New Book

```julia (editor=true, logging=false, output=true)
using Bonito, Tables
import Pkg; Pkg.activate("C:/Users/Hussin/Documents/GitHub/RPGSimulator.jl") # Quand ce sera le final on pourra l'enlever
using RPGSimulator

# Création des personnages
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# Simulation de 5 combats
all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")

# Affichage résumé des combats
Bonito.DOM.div(
    Bonito.DOM.h2("Résumé des combats"),
    Bonito.Table(summary)
)

```
```julia (editor=true, logging=false, output=true)
# Création des personnages
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# Simulation de 5 combats
all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")

# Préparation des données PV par round
pv = DataFrame(combat=all_logs.combat, round=all_logs.round, actor=all_logs.actor, pv=all_logs.actor_PV)

# Affichage points de vie par round
Bonito.DOM.div(
    Bonito.DOM.h2("Points de vie par round"),
    Bonito.Table(pv)
)

```
```julia (editor=true, logging=false, output=true)
# Simulation / exemple de données DEFENSE par round
defense_data = DataFrame(combat=Int[], round=Int[], actor=String[], defense=Int[])

# Simule données pour 2 personnages sur 5 rounds
for combat_id in 1:3
    for round in 0:5
        push!(defense_data, (combat_id, round, "Jed", max(10, 20 - round)))
        push!(defense_data, (combat_id, round, "Hussin", max(5, 15 - 2*round)))
    end
end

# Affichage avec Bonito
Bonito.DOM.div(
    Bonito.DOM.h2("Défense par round"),
    Bonito.Table(defense_data)
)

```
```julia (editor=true, logging=false, output=true)
using CSV, DataFrames, Statistics
using Bonito, Tables
using Plots
Plots.plotlyjs()  # Backend interactif

include("../Examples/test.jl")

# --- Création des personnages ---
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# --- Simulation de 5 combats ---
all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")

# --- Exemple : colonne DEFENSE pour le graphique ---
all_logs.defense = [archer.stats.DEFENSE for i in 1:nrow(all_logs)]
all_logs.defense[end÷2:end] .= gobelin.stats.DEFENSE

# --- Calcul défense moyenne par round et acteur ---
defense_summary = combine(groupby(all_logs, [:actor, :round]), :defense => mean)

# --- Création du graphique ---
fig = Plots.plot(title="Défense moyenne par round", xlabel="Round", ylabel="Défense")
for name in unique(defense_summary.actor)
    sub = filter(:actor => ==(name), defense_summary)
    Plots.plot!(fig, sub.round, sub.defense_mean, label=name, marker=:circle, linewidth=2)
end

# --- Export HTML pour inclusion dans Bonito ---
html_file = "defense_plot.html"
Plots.savefig(fig, html_file)  # sauvegarde en HTML interactif

# Sauvegarde en image
Plots.savefig(fig, "defense_plot.svg")  # PNG interactif limité, mais visible

# Affichage dans Bonito
Bonito.DOM.div(
    Bonito.DOM.h2("Résumé des combats"),
    Bonito.Table(summary),
    Bonito.DOM.h2("Défense moyenne par round"),
    Bonito.DOM.img(src="defense_plot.svg", width="800px")
)


```
```julia (editor=true, logging=false, output=true)
using CSV, DataFrames, Statistics
using Bonito, Tables
using PlotlyJS

include("../Examples/test.jl")

# --- Création des personnages ---
archer = Archer(nom="Jed")
archer.stats = Stats(PV=100, PM=20, ATK=30, VITESSE=40, DEFENSE=10)

gobelin = Gobelin(nom="Hussin")
gobelin.stats = Stats(PV=120, PM=0, ATK=35, VITESSE=40, DEFENSE=5)

# --- Simulation de 5 combats ---
all_logs, summary = simulate_many!(archer, gobelin, N=5, out_dir="data")

# --- Exemple : colonne DEFENSE pour le graphique ---
all_logs.defense = [archer.stats.DEFENSE for i in 1:nrow(all_logs)]
all_logs.defense[end÷2:end] .= gobelin.stats.DEFENSE

# --- Calcul défense moyenne par round et acteur ---
defense_summary = combine(groupby(all_logs, [:actor, :round]), :defense => mean)

# --- Création du graphique PlotlyJS ---
traces = []
for name in unique(defense_summary.actor)
    sub = filter(:actor => ==(name), defense_summary)
    push!(traces, scatter(
        x=sub.round,
        y=sub.defense_mean,
        mode="lines+markers",
        name=name
    ))
end

plt = Plot(traces, Layout(
    title="Défense moyenne par round",
    xaxis_title="Round",
    yaxis_title="Défense"
))

# --- Affichage dans BonitoBook ---
Bonito.DOM.div(
    Bonito.DOM.h2("Résumé des combats"),
    Bonito.Table(summary),
    Bonito.DOM.h2("Défense moyenne par round"),
    Bonito.PlotlyJS(plt)
)

```
```julia (editor=true, logging=false, output=true)
using WGLMakie
# Interactive 3D galaxy with real-time JavaScript integration
time_slider = Components.Slider(1:360; value=1)
spiral_factor = Components.Slider(1:50; value=20)
explosion = Components.Slider(1:100; value=50)
markersize = Components.Slider(LinRange(0.08, 2.0, 100); value=0.08)

# Generate 3D galaxy data
n_points = 1000
radii = sqrt.(LinRange(0.1, 1, n_points)) * 8
angles = LinRange(0, 4π, n_points) .+ radii * 0.3
points = Point3f.(radii .* cos.(angles), radii .* sin.(angles), 0) .+ randn(Point3f, n_points) .* (Point3f(0.3, 0.3, 2),)

fig, ax, mplot = meshscatter(points;
    color=first.(points), markersize=markersize.value[],
    figure=(; backgroundcolor=:black), axis=(; show_axis=false)
)

# Direct JavaScript integration with Julia observables
jss = js"""
$(mplot).then(plots=>{
    const time = $(time_slider.value);
    const spiral = $(spiral_factor.value);
    const explosion = $(explosion.value);
    const markersize = $(markersize.value);
    const plot = plots[0].plot_object;
    const initial_pos = $(points);

    function update_galaxy() {
        const new_pos = [];
        for (let i = 0; i < initial_pos.length; i++) {
            const [x, y, z] = initial_pos[i];
            const angle = Math.atan2(y, x) + time.value * 0.02;
            const radius = Math.sqrt(x*x + y*y);
            const spiralAngle = angle + radius * spiral.value * 0.05;
            const scale = explosion.value / 50;
            new_pos.push(
                radius * Math.cos(spiralAngle) * scale,
                radius * Math.sin(spiralAngle) * scale, z * scale
            );
        }
        plot.update([['positions_transformed_f32c', new_pos]]);
    }

    [time, spiral, explosion].forEach(obs => obs.on(update_galaxy));
    markersize.on(size => plot.update([['markersize', [size, size, size]]]));
});
"""

DOM.div(
    Grid(
        ["Time: ", time_slider],
        ["Spiral: ", spiral_factor],
        ["Explosion: ", explosion],
        ["Size: ", markersize];
        columns="auto 1fr", gap="10px 20px"
    ),
    fig, jss;
    style=Styles("padding" => "20px")
)
```
